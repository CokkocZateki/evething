{% extends "base.html" %}
{% import 'macros/icons.html' as icons %}

{% block extra_js %}
    <script type="text/javascript">$(document).ready(EVEthing.account.onload);</script>
{% endblock %}

{% block title %}My Account{% endblock %}

{% block content %}
      <div class="row-fluid">
        <div class="span12">
          <h2>Account Management</h2>

          {%- if message %}
          <div class="alert alert-{{ message_type }}">
            <strong>{{ message_type|capitalize }}:</strong> {{ message }}
          </div>
          {%- endif %}

          <ul class="nav nav-tabs">
            <li class="active"><a href="#tab_settings" data-toggle="tab">Settings</a></li>
            <li><a href="#tab_home_page" data-toggle="tab">Home Page</a></li>
            <li><a href="#tab_characters" data-toggle="tab">Characters</a></li>
            <li><a href="#tab_apikeys" data-toggle="tab">API Keys</a></li>
            <li><a href="#tab_skillplans" data-toggle="tab">Skill Plans</a></li>
            {%- if not disable_password %}
            <li><a href="#tab_password" data-toggle="tab">Change Password</a></li>
            {%- endif %}
          </ul>

          <div class="tab-content">
            {# settings: content -#}
            <div class="tab-pane active" id="tab_settings">
              {% include "thing/account/settings.html" %}
            </div>

            {# settings: content -#}
            <div class="tab-pane" id="tab_home_page">
              {% include "thing/account/home_page.html" %}
            </div>

            {# settings: content -#}
            <div class="tab-pane" id="tab_characters">
              {% include "thing/account/characters.html" %}
            </div>

            {# apikeys: content -#}
            <div class="tab-pane" id="tab_apikeys">
              {% include "thing/account/api_keys.html" %}
            </div>

            {# skillplan: content -#}
            <div class="tab-pane" id="tab_skillplans">
              {% include "thing/account/skill_plans.html" %}
            </div>

            {% if not disable_password %}{# password: content -#}
            <div class="tab-pane" id="tab_password">
              {% include "thing/account/change_passwords.html" %}
            </div>
            {%- endif %}

            {# apikeys: purge modal -#}
            <div class="modal hide" id="purge-apikey-modal">
              <form action="{{ url('thing.views.account_apikey_purge') }}" method="POST" class="form-inline">
                {{ csrf() }}
                <input type="hidden" name="apikey_id" value="a" id="purge-keyid-input">
                <div class="modal-header">
                  <a class="close" data-dismiss="modal">{{ icons.close_modal() }}</a>
                  <h3>Purge Confirmation</h3>
                </div>
                <div class="modal-body">
                  <p>
                    Are you sure you wish to purge API key #<strong><span id="purge-keyid"></span></strong> ("<span id="purge-keyname"></span>")?
                    This will delete <strong>ALL</strong> data related to the characters referenced by this API key!
                  </p>
                  <div class="alert alert-error">
                    <strong>WARNING</strong>: this is permanent, the only way to recover historical data is from a database backup!
                  </div>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-danger" data-dismiss="modal">No</button>
                  <button type="submit" class="btn btn-success">Yes</button>
                </div>
              </form>
            </div>

            {# apikeys: delete modal -#}
            <div class="modal hide" id="delete-apikey-modal">
              <form action="{{ url('thing.views.account_apikey_delete') }}" method="POST" class="form-inline">
                {{ csrf() }}
                <input type="hidden" name="apikey_id" value="a" id="delete-keyid-input">
                <div class="modal-header">
                  <a class="close" data-dismiss="modal">{{ icons.close_modal() }}</a>
                  <h3>Delete Confirmation</h3>
                </div>
                <div class="modal-body">
                  <p>
                    Are you sure you wish to delete API key #<strong><span id="delete-keyid"></span></strong> ("<span id="delete-keyname"></span>")?
                    This will unlink the associated characters from your account and any related data will no longer be visible to you!
                  </p>
                  <p>
                    Note: you can regain access to the data later by re-adding this API key.
                  </p>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-danger" data-dismiss="modal">No</button>
                  <button type="submit" class="btn btn-success">Yes</button>
                </div>
              </form>
            </div>

            {# skillplan: edit modal -#}
            <div class="modal hide" id="edit-skillplan-modal">
              <form action="{{ url('thing.views.account_skillplan_edit') }}" method="POST" class="form-horizontal">
                {{ csrf() }}
                <input type="hidden" name="skillplan_id" value="" id="edit-skillplan-id">
                <div class="modal-header">
                  <a class="close" data-dismiss="modal">{{ icons.close_modal() }}</a>
                  <h3>Edit Skill Plan</h3>
                </div>
                <div class="modal-body">
                  <fieldset>
                    <div class="control-group">
                      <label class="control-label" for="blueprint">Name</label>
                      <div class="controls">
                        <input type="text" id="edit-skillplan-name" name="name" value="">
                      </div>
                    </div>
                    <div class="control-group">
                      <label class="control-label" for="ml">Visibility</label>
                      <div class="controls">
                        <select id="edit-skillplan-visibility" name="visibility">
                          {%- for value, text in visibilities %}
                          <option value="{{ value }}">{{ text }}</option>
                          {%- endfor %}
                        </select>
                        <p class="help-block">Private: visibile only to your user account.</p>
                        <p class="help-block">Public: visibile to anyone on <u>your</u> character pages.</p>
                        <p class="help-block">Global: visibile to anyone on any character page.</p>
                      </div>
                    </div>
                  </fieldset>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-danger" data-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-success">Save</button>
                </div>
              </form>
            </div>

            {# skillplan: delete modal -#}
            <div class="modal hide" id="delete-skillplan-modal">
              <form action="{{ url('thing.views.account_skillplan_delete') }}" method="POST" class="form-inline">
                {{ csrf() }}
                <input type="hidden" name="skillplan_id" value="" id="delete-skillplan-id">
                <div class="modal-header">
                  <a class="close" data-dismiss="modal">{{ icons.close_modal() }}</a>
                  <h3>Delete Confirmation</h3>
                </div>
                <div class="modal-body">
                  <p>
                    Are you sure you wish to delete the skill plan named "<span id="delete-skillplan-name"></span>"?
                  </p>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-danger" data-dismiss="modal">No</button>
                  <button type="submit" class="btn btn-success">Yes</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
{% endblock %}
